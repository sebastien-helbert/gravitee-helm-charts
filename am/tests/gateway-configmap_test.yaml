suite: test that Gateway configmap 
templates:
  - "gateway/gateway-configmap.yaml"
tests:

  - it: should have custom settings for user management
    set:
      userManagement.resetPassword.token: 300
      userManagement.mfaChallenge.token: 360
      userManagement.password.policy.pattern: testpattern
      userManagement.email.policy.pattern: testemailpattern
      userManagement.name.policy.pattern: testnamepattern
      userManagement.username.policy.pattern: testusernamepattern

    asserts:
      - hasDocuments:
          count: 1
      - isKind:
          of: ConfigMap
      - matchRegex:
          path: data.[gravitee.yml]
          pattern: "[ ]{4}token: 300"
      - matchRegex:
          path: data.[gravitee.yml]
          pattern: "[ ]{4}token: 360"
      - matchRegex:
          path: data.[gravitee.yml]
          pattern: "[ ]{6}pattern: testpattern"
      - matchRegex:
          path: data.[gravitee.yml]
          pattern: "[ ]{6}pattern: testemailpattern"
      - matchRegex:
          path: data.[gravitee.yml]
          pattern: "[ ]{6}pattern: testnamepattern"
      - matchRegex:
          path: data.[gravitee.yml]
          pattern: "[ ]{6}pattern: testusernamepattern"


  - it: should set userManagement activity
    set:
      userManagement.activity.enabled: true  
      userManagement.activity.anon.algorithm: SHA512
      userManagement.activity.anon.salt: some-salt
      userManagement.activity.retention.time: 12
      userManagement.activity.retention.unit: WEEKS
      userManagement.activity.geolocation.variation.latitude: 0.09
      userManagement.activity.geolocation.variation.longitude: 0.07

    asserts:
      - hasDocuments:
          count: 1
      - isKind:
          of: ConfigMap
      - matchRegex:
          path: data.[gravitee.yml]
          pattern: "[ ]{2}enabled: true"
      - matchRegex:
          path: data.[gravitee.yml]
          pattern: "[ ]{3}algorithm: SHA512"
      - matchRegex:
          path: data.[gravitee.yml]
          pattern: "[ ]{3}salt: some-salt"
      - matchRegex:
          path: data.[gravitee.yml]
          pattern: "[ ]{4}time: 12"
      - matchRegex:
          path: data.[gravitee.yml]
          pattern: "[ ]{4}unit: WEEKS"
      - matchRegex:
          path: data.[gravitee.yml]
          pattern: "[ ]{5}latitude: 0.09"
      - matchRegex:
          path: data.[gravitee.yml]
          pattern: "[ ]{5}longitude: 0.07"